# AI 타로 상담 기록 저장 기능 구현 방안

무운 사주 서비스의 AI 타로 상담 기록을 저장하고 사용자가 다시 조회할 수 있는 기능을 구현하기 위한 기술적 방안을 다음과 같이 설계합니다. 주요 고려 사항은 **비용 효율성**과 **구현 용이성**입니다.

## 1. 로컬 스토리지 (Local Storage) 방식

사용자의 웹 브라우저에 직접 상담 기록을 저장하는 방식입니다. `localStorage` 또는 `IndexedDB`와 같은 브라우저 API를 활용합니다.

### 장점
*   **비용 없음**: 서버나 데이터베이스를 사용하지 않으므로 추가적인 운영 비용이 발생하지 않습니다. 이는 무료 서비스 모델에 매우 적합합니다.
*   **빠른 응답 속도**: 데이터를 로컬에서 직접 읽고 쓰기 때문에 서버와의 통신 지연 없이 빠르게 기록을 조회할 수 있습니다.
*   **구현 용이성**: 서버 측 로직 변경 없이 클라이언트 측 코드만으로 구현이 가능하여 개발 시간이 단축됩니다.

### 단점
*   **데이터 영속성 및 동기화 문제**: 사용자가 브라우저를 변경하거나, 캐시를 삭제하거나, 다른 기기에서 접속할 경우 이전 기록을 볼 수 없습니다. 데이터가 특정 기기에 종속됩니다.
*   **저장 용량 제한**: `localStorage`는 약 5MB, `IndexedDB`는 기기 저장 공간의 50%까지 허용되지만, 대량의 데이터를 저장하기에는 적합하지 않을 수 있습니다.
*   **보안 취약성**: 민감한 정보가 로컬에 저장될 경우 보안에 취약할 수 있습니다. (타로 기록의 민감도는 낮을 수 있음)

### 비용 영향
*   **추가 비용 없음**

### 구현 복잡도
*   **낮음**: 클라이언트 측 JavaScript 코드만으로 구현 가능합니다.

### 사용자 경험
*   동일 기기/브라우저에서는 빠르고 편리하게 기록 조회 가능.
*   기기 변경 시 기록 유실로 인한 불편함 발생.

## 2. 서버 측 데이터베이스 (Server-side Database) 방식

상담 기록을 서버의 데이터베이스에 저장하고, 사용자가 로그인하여 기록을 조회하는 방식입니다.

### 장점
*   **데이터 영속성 및 동기화**: 사용자가 어떤 기기에서 접속하든, 로그인만 하면 자신의 모든 상담 기록을 조회할 수 있습니다. 데이터 유실 위험이 적습니다.
*   **확장성**: 대량의 상담 기록을 안정적으로 저장하고 관리할 수 있습니다.
*   **보안성**: 민감한 데이터의 경우 서버에서 안전하게 관리할 수 있습니다.

### 단점
*   **비용 발생**: 데이터베이스 서버 운영 및 관리 비용이 발생합니다. (예: AWS RDS, Google Cloud SQL, Vercel Postgres 등) 이는 무료 서비스 모델에 부담이 될 수 있습니다.
*   **구현 복잡도 증가**: 사용자 인증(로그인), 데이터베이스 스키마 설계, 서버 API 개발, 클라이언트-서버 통신 로직 등 구현해야 할 부분이 많아집니다.
*   **응답 속도 저하 가능성**: 서버와의 통신이 필요하므로 로컬 스토리지 방식보다 응답 속도가 느려질 수 있습니다.

### 비용 영향
*   **추가 비용 발생**: 데이터베이스 서비스 사용료, 서버리스 함수 호출 비용 등.

### 구현 복잡도
*   **높음**: 백엔드 및 프론트엔드 개발이 모두 필요합니다.

### 사용자 경험
*   어떤 기기에서든 일관된 기록 조회 가능.
*   로그인 절차 필요.

## 결론 및 권장 사항

무운 사주 서비스가 **무료 서비스**임을 고려할 때, **추가 비용이 발생하지 않는 로컬 스토리지 방식**이 현재로서는 가장 적합하다고 판단됩니다. `IndexedDB`를 활용하면 `localStorage`보다 더 많은 데이터를 저장할 수 있으며, 비동기 처리로 성능 저하를 최소화할 수 있습니다.

만약 향후 사용자 수가 증가하고, 유료 서비스 전환 또는 사용자별 맞춤형 서비스 제공이 필요해진다면, 그때 서버 측 데이터베이스 방식으로 전환하는 것을 고려할 수 있습니다. 초기에는 비용 효율적인 로컬 스토리지 방식으로 시작하여 사용자 피드백을 수렴하는 것이 합리적입니다.

**권장 방안**: `IndexedDB`를 활용한 로컬 스토리지 방식 구현. 사용자에게는 


## 3. 데이터 구조 (IndexedDB Schema)

`IndexedDB`에 저장될 타로 상담 기록의 데이터 구조(스키마)는 다음과 같이 제안합니다.

| 필드명 (Field Name) | 타입 (Type) | 설명 (Description) | 비고 (Notes) |
| :------------------ | :---------- | :----------------- | :----------- |
| `id`                | `Number`    | 기록의 고유 식별자 | 자동 증가 또는 타임스탬프 기반 |
| `timestamp`         | `Number`    | 상담이 진행된 시간 | `Date.now()` 값 (Unix timestamp) |
| `question`          | `String`    | 사용자의 질문      |              |
| `selectedCards`     | `Array`     | 선택된 타로 카드 정보 | 각 카드 객체는 `id`, `name`, `korName`, `image` 포함 |
| `interpretation`    | `String`    | AI가 생성한 해석 내용 | 마크다운 형식 포함 |

**`selectedCards` 배열 내 카드 객체 구조:**

```typescript
interface TarotCard {
  id: number;
  name: string;
  korName: string;
  image: string; // 카드 이미지 URL
}
```

## 4. UI/UX 시나리오

사용자가 타로 상담 기록을 저장하고 조회하는 과정에 대한 UI/UX 시나리오는 다음과 같습니다.

### 4.1. 상담 기록 저장

1.  **해석 완료 후**: AI 타로 해석 결과가 화면에 표시된 후, 결과 하단에 **"내 기록으로 저장하기"** 버튼을 노출합니다.
2.  **저장 확인**: 사용자가 버튼을 클릭하면, 기록이 성공적으로 저장되었음을 알리는 토스트 메시지(예: "상담 기록이 저장되었습니다!")를 표시합니다.
3.  **중복 저장 방지**: 이미 저장된 기록이거나, 현재 상담 세션에서 한 번 저장한 기록이라면 버튼을 비활성화하거나 "저장됨" 상태로 변경하여 중복 저장을 방지합니다.

### 4.2. 상담 기록 조회

1.  **메뉴 접근**: 웹사이트의 글로벌 내비게이션 바(GNB) 또는 AI 타로 페이지 내에 **"내 타로 기록"** 또는 **"상담 기록"**과 같은 메뉴 항목을 추가합니다.
2.  **기록 목록 표시**: 해당 메뉴를 클릭하면, 저장된 모든 타로 상담 기록의 목록을 최신순으로 정렬하여 보여줍니다. 각 목록 항목에는 질문, 상담 날짜, 선택된 카드 요약 정보 등을 간략하게 표시합니다.
3.  **기록 상세 조회**: 목록에서 특정 기록을 클릭하면, 해당 기록의 상세 내용(질문, 선택된 카드, AI 해석 전문)을 볼 수 있는 페이지로 이동합니다.
4.  **기록 삭제**: 상세 조회 페이지 또는 목록 항목에 **"삭제"** 버튼을 제공하여 사용자가 원하지 않는 기록을 개별적으로 삭제할 수 있도록 합니다. 삭제 시에는 사용자에게 확인 메시지를 표시하여 실수로 인한 삭제를 방지합니다.

### 4.3. 기록 없음

*   저장된 기록이 없을 경우, "아직 저장된 타로 기록이 없습니다. 지금 바로 상담을 시작해 보세요!"와 같은 안내 메시지를 표시하고, 새로운 상담을 시작할 수 있는 버튼을 제공합니다.

이러한 UI/UX 시나리오를 통해 사용자는 자신의 타로 상담 기록을 편리하게 관리하고 다시 찾아볼 수 있을 것입니다.
